/* ======================================================================
   styles.css — UI for IPTV page
   - Dark theme tokens + base reset
   - Header (clock, refresh, histats) + live-viewers ใต้ clock
   - Player
   - Tabs + Grid + Channel cards (+ badge สำรอง)
   - Now bar ใต้วิดีโอ (now-playing กึ่งกลาง)
   - Responsive + A11y + Reduced motion + Safe-area
====================================================================== */

/* ---------- Root tokens ---------- */
:root{
  /* Colors */
  --bg:#0b0c0e;
  --panel:#141516;
  --panel-2:#101112;
  --text:#f2f2f2;
  --muted:#a0a7b0;
  --border:#242628;

  /* Layout */
  --maxw:1200px;

  /* Font (clean Thai) */
  --font: "Sarabun","Noto Sans Thai","Inter",system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
  --font-size: 14.5px;
  --font-weight: 600;
  --font-strong: 700;

  /* Channel card sizing */
  --tile-w:104px;
  --tile-h:128px;       /* +สูงขึ้นเพื่อรองรับชื่อ 2 บรรทัด */
  --tile-g:12px;
  --logo-max-h:52px;
  --logo-max-w:82px;
  --logo-wide-h:42px;

  /* Tabs (compact + readable) */
  --tabW: 72px;
  --tabH: 58px;
  --tab-gap:6px;
  --tabBadge:28px;
  --tab-font:12.2px;

  /* Header HUD */
  --hud-size:32px;
  --hud-radius:12px;

  /* Histats size (รีเฟรชอิงขนาดนี้แม้ซ่อนไว้) */
  --hs-size: 40px;
  --hs-scale: 1;

  /* ค่ากว้างปุ่มรีเฟรช (เซ็ตโดย JS) */
  --refresh-btn-w: 112px;
}

/* ---------- Base / Reset ---------- */
*{ box-sizing:border-box }
html,body{ height:100% }
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:var(--font);
  font-size:var(--font-size);
  font-weight:var(--font-weight);
  letter-spacing:.2px;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}
img{ max-width:100%; display:block }
button{ font:inherit; background:none; border:0; color:inherit; cursor:pointer }
a{ color:inherit; text-decoration:none }

/* ---------- Skip link ---------- */
.skip-link{
  position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden;
}
.skip-link:focus{
  left:12px; top:12px; width:auto; height:auto; padding:8px 10px; z-index:9999;
  background:rgba(0,0,0,.75); color:#fff; border-radius:10px;
  border:1px solid rgba(255,255,255,.25); font-weight:800; letter-spacing:.2px;
}

/* ---------- Containers ---------- */
.container{ width:min(100%,var(--maxw)); margin:0 auto; padding:14px }
.app{
  width:min(100%,var(--maxw)); margin:0 auto; padding:12px 14px 40px;
  padding-bottom: max(40px, env(safe-area-inset-bottom));
}

/* ---------- Header ---------- */
header{
  position:sticky; top:0; z-index:20;
  border-bottom:1px solid var(--border);
  background:linear-gradient(180deg,rgba(0,0,0,.45),rgba(0,0,0,0));
  backdrop-filter: blur(6px);
  padding-top: max(10px, env(safe-area-inset-top));
}
.h-wrap{
  position:relative;
  width:min(100%,var(--maxw)); margin:auto;
  display:grid; justify-items:center; gap:4px;
  min-height: calc(max(var(--hud-size), var(--hs-size)) + 12px);
  padding:10px 14px;

  /* เผื่อที่ซ้าย/ขวาให้เท่ากับชิ้นส่วนใหญ่สุด (Refresh / Histats) */
  padding-left:  calc(max(var(--hud-size), var(--hs-size)) + 16px);
  padding-right: calc(max(var(--hud-size), var(--hs-size)) + 16px);
}
.clock{
  font-weight:800; font-size:clamp(16px,2.6vw,20px); letter-spacing:.3px;
  font-variant-numeric: tabular-nums; color:#f4f7fb; text-align:center;
  text-shadow:none; opacity:.98;
}
/* เดิมเคยแสดง now-playing ใน header — ตอนนี้ย้ายลงไปใต้ VDO แล้ว */
.now-playing{
  margin-top:2px; font-size:clamp(13.5px,2.1vw,17.5px);
  font-weight:var(--font-strong); letter-spacing:.2px;
  color:#eaf1ff; opacity:.96; text-align:center;
  max-width:100%; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
  background:none; border:none; box-shadow:none;
}
.now-playing.swap{ animation: npFade .24s ease both }
@keyframes npFade{from{opacity:0;transform:translateY(4px)}to{opacity:.96;transform:none}}

/* ---------- Live viewers (ใต้ clock) ---------- */
#live-viewers{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:6px 10px;
  border-radius:999px;

  /* Fallback */
  border:1px solid rgba(255,255,255,.14);
  background:rgba(255,255,255,.06);

  /* Modern mix */
  border:1px solid color-mix(in oklab, currentColor 16%, transparent);
  background:color-mix(in oklab, currentColor 6%, transparent);

  font-size:13px;
  font-weight:700;
  color:inherit;
  backdrop-filter:saturate(1.05) blur(6px);
  -webkit-backdrop-filter:saturate(1.05) blur(6px);
}
#live-viewers .dot{
  width:8px; height:8px; border-radius:50%;
  background:#22c55e;
  box-shadow:0 0 0 2px color-mix(in oklab, #22c55e 25%, transparent);
}
#live-viewers .label{ opacity:.72; font-weight:600 }
#live-viewers .n{ font-variant-numeric: tabular-nums }

/* จัดระยะเมื่ออยู่ใน header grid (อยู่ใต้ clock) */
.h-wrap #live-viewers{ margin-top:4px; }
@media (max-width:540px){ .h-wrap #live-viewers{ margin-top:6px; } }

/* ---------- Histats (ซ่อนตั้งแต่ต้น ป้องกัน flash) ---------- */
#histats_counter{
  position:absolute!important;
  width:1px!important; height:1px!important;
  overflow:hidden!important;
  clip:rect(0 0 0 0)!important;
  clip-path: inset(50%)!important;
  opacity:0!important;
  pointer-events:none!important;
  z-index:-1!important;
}
#histats_counter #histatsC{ position:static !important }
#histats_counter img{
  max-height:var(--hs-size) !important; height:var(--hs-size) !important; width:auto !important;
}

/* ---------- Refresh button (ตรึงซ้ายใน header) ---------- */
.refresh-btn{
  position:absolute; left:8px; top:50%; transform:translateY(-50%);
  height: var(--hs-size); line-height: var(--hs-size);
  display:inline-flex; align-items:center; gap:8px; padding:0 12px;
  border-radius: var(--hud-radius);
  background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
  border:1px solid rgba(255,255,255,.18);
  color:var(--text);
  font-weight:var(--font-strong); font-size:12px; letter-spacing:.2px;
  box-shadow:0 6px 14px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.35);
  backdrop-filter: blur(6px);
  transition:transform .15s ease, border-color .15s ease, box-shadow .15s ease; z-index:3;
}
.refresh-btn .i{ font-size: calc(var(--hs-size) * .38); line-height:1 }
.refresh-btn:hover{ transform:translateY(-50%) translateY(-1px); border-color:rgba(255,255,255,.5) }
.refresh-btn:active{ transform:translateY(-50%) scale(.985) }
.refresh-btn[disabled]{ opacity:.65; cursor:wait }

/* ข้อความสถานะข้างปุ่ม (โชว์หลังรีเฟรชเสร็จ) */
#refresh-status{
  position:absolute; z-index:3;
  left: calc(8px + var(--refresh-btn-w) + 8px);
  top:50%; transform: translateY(-50%);
  background:linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,.35));
  border:1px solid rgba(255,255,255,.2);
  box-shadow:0 6px 14px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.25);
  color:#e6f2ff; padding:4px 10px; border-radius:10px;
  font-weight:800; font-size:12px; letter-spacing:.2px; white-space:nowrap;
  opacity:0; pointer-events:none; transition:opacity .16s ease, transform .16s ease;
}
#refresh-status.on{ opacity:.98; transform: translateY(-50%) translateY(-2px); }

/* ---------- Player ---------- */
#player{
  width:100%; aspect-ratio:16/9; background:#000; border-radius:16px; overflow:hidden;
  border:1px solid var(--border); box-shadow:0 8px 18px rgba(0,0,0,.25) inset;
}

/* ---------- Tabs ---------- */
.tabs{
  position:relative; display:flex; gap:clamp(8px, 1.1vw, 12px);
  padding:12px 6px 14px; margin:10px auto 10px;
  overflow:auto; scroll-snap-type:x mandatory; -webkit-overflow-scrolling:touch;
  width:min(100%,var(--maxw));
  scrollbar-color: #2b2d30 transparent; /* Firefox */
  scrollbar-width: thin;                /* Firefox */
}
.tabs::-webkit-scrollbar{ height:6px }
.tabs::-webkit-scrollbar-thumb{ background:#2b2d30; border-radius:8px }
.tabs.tabs--center{ justify-content:center }
.tabs::before{
  content:""; position:absolute; inset:0; pointer-events:none; z-index:-1;
  background:
    radial-gradient(120% 80% at 10% 0%, rgba(99,102,241,.18) 0%, transparent 45%),
    radial-gradient(120% 80% at 90% 100%, rgba(168,85,247,.18) 0%, transparent 45%),
    linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,0));
  filter:blur(20px); opacity:.8;
}
.tab{ position:relative; flex:0 0 auto; cursor:pointer; scroll-snap-align:center; -webkit-tap-highlight-color:transparent }
.tab-card{
  width:var(--tabW); height:var(--tabH);
  border-radius:10px; display:grid; grid-template-rows:auto auto; place-items:center; gap:var(--tab-gap);
  background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12);
  box-shadow:0 1px 0 rgba(255,255,255,.06) inset, 0 6px 14px rgba(0,0,0,.22);
  color:#fff;
  transform: translateZ(0) scale(1); transform-origin:50% 50%;
  transition: transform .18s cubic-bezier(.2,.7,.2,1), box-shadow .18s ease, border-color .18s ease;
  will-change:transform; z-index:0;
}
.tab-icon{
  width:var(--tabBadge); height:var(--tabBadge);
  display:grid; place-items:center; border-radius:12px;
  background:linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.06));
  border:1px solid rgba(255,255,255,.22);
  box-shadow:inset 0 1px 0 rgba(255,255,255,.55), 0 4px 12px rgba(0,0,0,.35);
}
.tab-icon svg{ width:max(12px, calc(var(--tabBadge) - 6px)); height:max(12px, calc(var(--tabBadge) - 6px)); display:block }
.tab-label{
  position:relative; top:-2px;
  font-family:var(--font); font-weight:800;
  font-size:var(--tab-font); line-height:1.05; letter-spacing:.25px;
}
@media (hover:hover){
  .tabs .tab:hover .tab-card{
    transform:translateZ(0) scale(1.055);
    box-shadow: 0 1px 0 rgba(255,255,255,.08) inset, 0 10px 18px rgba(0,0,0,.28), 0 0 14px rgba(255,255,255,.10);
    border-color:rgba(255,255,255,.28);
  }
  .tabs .tab:active .tab-card{ transform:translateZ(0) scale(.985) }
}
.tabs .tab:focus-visible .tab-card{ outline:2px solid #8ab4ff; outline-offset:3px }

/* Selected accent per category */
.tab[data-filter="IPTV"]   { --accent: #60a5fa; }
.tab[data-filter="บันเทิง"] { --accent: #f59e0b; }
.tab[data-filter="กีฬา"]    { --accent: #34d399; }
.tab[data-filter="สารคดี"]  { --accent: #a78bfa; }
.tab[data-filter="เด็ก"]    { --accent: #f472b6; }
.tab[data-filter="หนัง"]    { --accent: #fb7185; }
.tabs .tab[aria-selected="true"] .tab-card{
  transform: translateZ(0) scale(1.06);
  border-color: var(--accent, rgba(255,255,255,.34));
  box-shadow: 0 0 0 2px rgba(255,255,255,.22) inset, 0 12px 22px rgba(0,0,0,.32), 0 0 14px rgba(255,255,255,.18);
  z-index: 2; position: relative;
}
.tabs .tab[aria-selected="true"] .tab-card::after{
  content:""; position:absolute; left:50%; bottom:-5px; transform:translateX(-50%);
  width:40%; height:3px; border-radius:3px; background: var(--accent, #86efac);
  filter: drop-shadow(0 0 6px rgba(255,255,255,.25)); pointer-events:none;
}

/* ---------- Grid ---------- */
.grid{
  width:min(100%,var(--maxw)); margin:12px auto 0; display:grid;
  grid-template-columns:repeat(auto-fit,minmax(var(--tile-w),1fr)); /* auto-fit เพื่อไม่ให้มีคอลัมน์ว่าง */
  gap:var(--tile-g); justify-items:center;
  transition:opacity .14s ease, filter .14s ease;
  overflow: visible; /* ปล่อยเงา/ขอบเรืองแสงไม่ให้ถูกตัด */
}
.grid.switch-out{ opacity:.3; filter:blur(2px) }
.grid.switch-in .channel{
  opacity:0; transform:translateY(6px) scale(.98); filter:blur(4px);
  animation:tileIn .34s cubic-bezier(.2,.7,.2,1) forwards;
  animation-delay:calc(var(--stagger) * var(--i,0));
}
@keyframes tileIn{to{opacity:1;transform:none;filter:none}}

/* ---------- Channel card ---------- */
.channel{ position:relative; width:var(--tile-w); height:var(--tile-h); border-radius:14px; cursor:pointer; transform:translateZ(0) }
.channel::after{
  content:""; position:absolute; inset:-6px; border-radius:18px;
  background:radial-gradient(60% 60% at 50% 50%, rgba(255,255,255,.5) 0%, transparent 70%);
  filter:blur(12px); opacity:0; transition:opacity .25s ease; pointer-events:none; z-index:0;
}
.channel:hover::after,
.channel.active::after{ opacity:.9; animation:neonPulse 2.4s ease-in-out infinite }
@keyframes neonPulse{ 0%{filter:blur(9px);opacity:.5} 50%{filter:blur(14px);opacity:.95} 100%{filter:blur(9px);opacity:.5} }

.ch-card{
  position:relative; z-index:1; width:100%; height:100%;
  background:linear-gradient(180deg,var(--panel),var(--panel-2));
  border:1px solid var(--border); border-radius:12px; padding:9px 8px 8px;
  box-shadow:0 6px 16px rgba(0,0,0,.18);
  display:grid; grid-template-rows:1fr auto; gap:6px; place-items:center; overflow:hidden;
  transition:transform .12s ease, border-color .15s ease, box-shadow .15s ease;
}
.channel:hover .ch-card{
  transform:translateY(-1px);
  border-color:rgba(255,255,255,.7);
  box-shadow:0 0 0 1px rgba(255,255,255,.55) inset, 0 0 10px rgba(255,255,255,.22);
}
.channel:active .ch-card{ transform:scale(.985) }

/* Focus ring สำหรับคีย์บอร์ด */
.channel:focus-visible .ch-card{
  outline: 2px solid #8ab4ff;
  outline-offset: 2px;
  box-shadow: 0 0 0 2px rgba(138,180,255,.35) inset, 0 0 10px rgba(138,180,255,.25);
}

/* ==== Channel selected (เล่นอยู่) ==== */
.channel.active .ch-card,
.channel[aria-selected="true"] .ch-card,
.channel[data-selected="true"] .ch-card{
  transform: translateY(-1px);
  border-color: rgba(255,255,255,.85);
  box-shadow:
    0 0 0 1px rgba(255,255,255,.6) inset,
    0 0 12px rgba(255,255,255,.25);
}
.channel[aria-selected="true"]::after,
.channel[data-selected="true"]::after{ opacity:.95; animation:neonPulse 2.4s ease-in-out infinite }

/* โลโก้ */
.logo-wrap{ display:grid; place-items:center; width:100%; height:100% }
.logo{
  max-height: calc(var(--logo-max-h) - 2px);
  max-width: var(--logo-max-w);
  object-fit:contain;
  filter:drop-shadow(0 1px 1px rgba(0,0,0,.35));
}
.channel[data-wide="true"] .logo{ max-height:var(--logo-wide-h) }

/* ชื่อช่อง: 2 บรรทัด + ellipsis */
.name{
  width:100%;
  text-align:center;
  font-family:var(--font);
  font-weight:700;
  font-size:11px;
  line-height:1.18;
  color:#eaeef3; opacity:.95;

  white-space: normal;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;

  min-height: calc(2 * 1.18em); /* ให้ตรงกับ line-height */
}

/* Badge: สำรอง (backup) */
.badge{
  position:absolute; top:6px; right:6px;
  display:inline-flex; align-items:center; justify-content:center;
  padding:2px 6px; border-radius:999px;
  font-size:10px; font-weight:800; letter-spacing:.2px;
  background:rgba(255,255,255,.12);
  border:1px solid rgba(255,255,255,.25);
  color:#eaf1ff; pointer-events:none; user-select:none;
  text-shadow:0 1px 0 rgba(0,0,0,.35);
  backdrop-filter: blur(4px);
}
.badge.backup{
  background:linear-gradient(180deg, rgba(59,130,246,.25), rgba(59,130,246,.10));
  border-color:rgba(59,130,246,.45);
}

/* Ripple */
.ripple{
  position:absolute; border-radius:50%;
  background:radial-gradient(circle at center, rgba(255,255,255,.55), rgba(255,255,255,0));
  transform:scale(0); animation:ripple .5s ease-out; pointer-events:none
}
@keyframes ripple{ to{ transform:scale(1); opacity:0 } }

/* ---------- Now bar ใต้ VDO (now-playing กึ่งกลาง) ---------- */
#now-bar.now-bar{
  display:flex;
  align-items:center;
  justify-content:center;   /* กึ่งกลาง */
  gap:12px;
  margin:10px 0 16px;
}
#now-playing{
  font-weight:700;
  font-size:14px;
  letter-spacing:.2px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  max-width:100%;
  color:inherit;
  opacity:.95;
  text-align:center;        /* กึ่งกลางข้อความ */
}

/* Grid busy state */
#channel-list[aria-busy="true"]{ cursor:progress }

/* ---------- Reduced motion ---------- */
@media (prefers-reduced-motion: reduce){
  *{ animation: none !important; transition: none !important; scroll-behavior: auto !important; }
  .grid.switch-in .channel{ opacity:1 !important; transform:none !important; filter:none !important; }
}

/* ---------- Responsive ---------- */
@media (max-width: 380px){
  :root{
    --tabW: 66px; --tabH: 54px; --tabBadge: 26px; --tab-font: 11.6px;
    --hs-size:34px; --hs-scale:.9;
    --tile-h:132px;
  }
  .tabs{ gap:8px; padding:10px 6px 12px }
  .refresh-btn .t{ display:none }
  #refresh-status{ display:none }
}
@media (min-width: 381px) and (max-width: 639px){
  :root{ --tabW: 70px; --tabH: 56px; --tabBadge: 28px; --tab-font: 12px; --hs-size:36px; --hs-scale:.94 }
}
@media (min-width: 640px) and (max-width: 1023px){
  :root{ --tabW: 78px; --tabH: 62px; --tabBadge: 30px; --tab-font: 12.4px; --hs-size:40px }
}
@media (min-width: 1024px){
  :root{ --tabW: 84px; --tabH: 66px; --tabBadge: 32px; --tab-font: 12.8px; --hs-size:44px; --hs-scale:1.05 }
}
@media (min-width: 1280px){
  /* histats ถูกซ่อนอยู่แล้ว ตรงนี้คง scale ไว้เผื่อ */
  #histats_counter{ transform:translateY(-50%) scale(var(--hs-scale)) }
}



/* Clamp channel name to 2 lines (prevent overflow) */
.ch-card .name{
  display:-webkit-box;
  -webkit-line-clamp:2;
  line-clamp:2;
  -webkit-box-orient: vertical;
  overflow:hidden;
  line-height:1.2;
}


/* Skeleton shimmer while player loads */
#player:empty::after{
  content:"";
  display:block;
  width:100%; height:100%;
  border-radius:16px;
  background: linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.14), rgba(255,255,255,0.06));
  background-size: 300% 100%;
  animation: shimmer 1.4s ease-in-out infinite;
}
@keyframes shimmer{ 0%{ background-position:0% 50% } 100%{ background-position:100% 50% } }


/* Refresh icon animation while reloading */
.refresh-btn[disabled] .i{ animation: spin 1s linear infinite; }
@keyframes spin{ to{ transform: rotate(360deg); } }
