/* ===================== styles.css (FULL) =====================
   - Glass header + เวลา + now playing (สมดุล: ซ้าย Refresh ⟷ กลาง Clock ⟷ ขวา Histats)
   - Tabs แบบ badge โปร่ง + เอฟเฟกต์ hover/active/selected ครบ (accent รายหมวด + ขีดล่าง)
   - กริดช่องขนาดคงที่ + เอฟเฟกต์สลับหมวด
   - รองรับโลโก้แนวนอน (data-wide)
   - ปุ่มรีเฟรชกลืนธีม, responsive ทุกหน้าจอ
============================================================== */

/* ---------- Root tokens ---------- */
:root{
  --bg:#0b0c0e;
  --panel:#141516;
  --panel-2:#101112;
  --text:#f2f2f2;
  --muted:#a0a7b0;
  --border:#242628;
  --maxw:1200px;

  /* Channel card sizing */
  --tile-w:104px;
  --tile-h:120px;
  --tile-g:12px;
  --logo-max-h:52px;
  --logo-max-w:82px;
  --logo-wide-h:42px;

  /* Tabs */
  --tab-gap:6px;
  --tabBadge:24px;

  /* Header HUD (refresh/histats) */
  --hud-size:34px;
  --hud-gap:10px;
  --hud-radius:12px;
}

/* ---------- Reset ---------- */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; background:var(--bg); color:var(--text);
  font-family:system-ui,-apple-system,'Sarabun','Inter',Segoe UI,Roboto,Arial,sans-serif;
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
}
img{max-width:100%;display:block}
button{font:inherit;background:none;border:0;color:inherit}
a{color:inherit;text-decoration:none}

/* ---------- Layout wrappers ---------- */
.container{ width:min(100%,var(--maxw)); margin:0 auto; padding:14px }
.app{ width:min(100%,var(--maxw)); margin:0 auto; padding:12px 14px 40px }

/* ---------- Header ---------- */
header{
  position:sticky; top:0; z-index:20;
  border-bottom:1px solid var(--border);
  background:linear-gradient(180deg,rgba(0,0,0,.45),rgba(0,0,0,0));
  backdrop-filter: blur(6px);
}
.h-wrap{
  position:relative; width:min(100%,var(--maxw)); margin:auto;
  display:grid; justify-items:center; gap:4px;
  /* กันพื้นที่ซ้าย/ขวาให้ปุ่ม/เคาน์เตอร์ แล้วคงความกลางของเวลา */
  min-height: calc(var(--hud-size) + 12px);
  padding:10px 14px;
  padding-left:  calc(var(--hud-size) + 16px);
  padding-right: calc(var(--hud-size) + 16px);
}
.clock{font-weight:700;font-size:clamp(15px,2.3vw,19px);letter-spacing:.2px;text-align:center}
.now-playing{
  margin-top:2px;font-size:clamp(13px,2vw,16px);font-weight:600;opacity:.92;
  text-align:center;max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;
}
.now-playing.swap{animation:npFade .24s ease both}
@keyframes npFade{from{opacity:0;transform:translateY(4px)}to{opacity:.92;transform:none}}

/* ---------- Histats (ขวาของ header) ---------- */
#histats_counter{
  position:absolute; right:8px; top:50%;
  transform:translateY(-50%) scale(0.95);
  transform-origin:100% 50%;
  height:var(--hud-size); display:grid; place-items:center; z-index:2;
}
#histats_counter #histatsC{ position:static !important }
#histats_counter img{
  max-height:var(--hud-size) !important; height:var(--hud-size) !important; width:auto !important;
  opacity:.92; filter:drop-shadow(0 1px 2px rgba(0,0,0,.45))
}

/* ---------- Refresh button (ซ้ายของ header) ---------- */
.refresh-btn{
  position:absolute; left:8px; top:50%; transform:translateY(-50%);
  height: var(--hud-size); line-height: var(--hud-size);
  display:inline-flex; align-items:center; gap:8px;
  padding:0 12px; border-radius: var(--hud-radius);
  background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
  border:1px solid rgba(255,255,255,.18);
  color:var(--text); font-weight:700; font-size:12px;
  box-shadow:0 6px 14px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.35);
  backdrop-filter: blur(6px);
  cursor:pointer; transition:transform .15s ease, border-color .15s ease, box-shadow .15s ease;
  z-index:3;
}
.refresh-btn .i{ font-size:14px; line-height:1 }
.refresh-btn:hover{ transform:translateY(-50%) translateY(-1px); border-color:rgba(255,255,255,.5) }
.refresh-btn:active{ transform:translateY(-50%) scale(.985) }
.refresh-btn[disabled]{ opacity:.65; cursor:wait }

/* ---------- Player ---------- */
#player{
  width:100%; aspect-ratio:16/9; background:#000; border-radius:16px; overflow:hidden;
  border:1px solid var(--border); box-shadow:0 8px 18px rgba(0,0,0,.25) inset;
}

/* ---------- Tabs (badge โปร่ง) ---------- */
.tabs{
  position:relative; display:flex; gap:12px; padding:14px 6px 16px; margin:12px auto 10px;
  overflow:auto; scroll-snap-type:x mandatory; -webkit-overflow-scrolling:touch;
  width:min(100%,var(--maxw));
}
.tabs::-webkit-scrollbar{height:6px}
.tabs::-webkit-scrollbar-thumb{background:#2b2d30;border-radius:8px}
.tabs.tabs--center{justify-content:center}
.tabs::before{
  content:""; position:absolute; inset:0; pointer-events:none; z-index:-1;
  background:
    radial-gradient(120% 80% at 10% 0%, rgba(99,102,241,.22) 0%, transparent 45%),
    radial-gradient(120% 80% at 90% 100%, rgba(168,85,247,.22) 0%, transparent 45%),
    linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,0));
  filter:blur(20px); opacity:.8;
}
.tab{position:relative; flex:0 0 auto; cursor:pointer; scroll-snap-align:center; -webkit-tap-highlight-color:transparent}
.tab-card{
  width:clamp(70px,11vw,88px); height:clamp(56px,9.8vw,70px);
  border-radius:10px; display:grid; grid-template-rows:auto auto; place-items:center;
  gap:var(--tab-gap);
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.12);
  box-shadow:0 1px 0 rgba(255,255,255,.06) inset, 0 6px 14px rgba(0,0,0,.22);
  color:#fff;
  transform: translateZ(0) scale(1);
  transform-origin:50% 50%;
  transition:
    transform .18s cubic-bezier(.2,.7,.2,1),
    box-shadow .18s ease,
    border-color .18s ease;
  will-change:transform;
  z-index:0;
}
.tab-icon{
  position:relative; width:var(--tabBadge); height:var(--tabBadge);
  display:grid; place-items:center; border-radius:12px;
  background:linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.06));
  border:1px solid rgba(255,255,255,.22);
  box-shadow:inset 0 1px 0 rgba(255,255,255,.55), 0 4px 12px rgba(0,0,0,.35);
}
.tab-icon svg{width:14px;height:14px;display:block}
.tab-label{font-weight:700;font-size:10.8px;letter-spacing:.2px}

/* Hover/Active base */
@media (hover:hover){
  .tabs .tab:hover .tab-card{
    transform:translateZ(0) scale(1.06);
    box-shadow:
      0 1px 0 rgba(255,255,255,.08) inset,
      0 10px 18px rgba(0,0,0,.28),
      0 0 14px rgba(255,255,255,.10);
    border-color:rgba(255,255,255,.28);
  }
  .tabs .tab:active .tab-card{ transform:translateZ(0) scale(.985) }
}
.tabs .tab:focus-visible .tab-card{ outline:2px solid #8ab4ff; outline-offset:3px }

/* ---------- Grid (channels) ---------- */
.grid{
  width:min(100%,var(--maxw)); margin:12px auto 0; display:grid;
  grid-template-columns:repeat(auto-fill,minmax(var(--tile-w),1fr));
  gap:var(--tile-g); justify-items:center;
  opacity:1; transform:none; filter:none;
}
.grid.switch-in .channel{
  opacity:0; transform:translateY(6px) scale(.98); filter:blur(4px);
  animation:tileIn .34s cubic-bezier(.2,.7,.2,1) forwards;
  animation-delay:calc(var(--stagger) * var(--i,0)); will-change:transform,opacity,filter;
}
@keyframes tileIn{to{opacity:1;transform:none;filter:none}}
.grid.switch-out,.grid.switch-in{contain:paint}

/* ---------- Channel card ---------- */
.channel{position:relative;width:var(--tile-w);height:var(--tile-h);border-radius:14px;cursor:pointer;transform:translateZ(0)}
.channel::after{
  content:"";position:absolute;inset:-6px;border-radius:18px;
  background:radial-gradient(60% 60% at 50% 50%, rgba(255,255,255,.55) 0%, transparent 70%);
  filter:blur(12px);opacity:0;transition:opacity .25s ease;pointer-events:none;z-index:0;
}
.channel:hover::after,.channel.active::after{opacity:.9;animation:neonPulse 2.4s ease-in-out infinite}
@keyframes neonPulse{0%{filter:blur(9px);opacity:.5}50%{filter:blur(14px);opacity:.95}100%{filter:blur(9px);opacity:.5}}

.ch-card{
  position:relative; z-index:1; width:100%; height:100%;
  background:linear-gradient(180deg,var(--panel),var(--panel-2));
  border:1px solid var(--border); border-radius:12px;
  padding:9px 8px 8px; box-shadow:0 6px 16px rgba(0,0,0,.18);
  display:grid; grid-template-rows:1fr auto; gap:6px; place-items:center; overflow:hidden;
  transition:transform .12s ease, border-color .15s ease, box-shadow .15s ease;
}
.channel:hover .ch-card{
  transform:translateY(-1px);border-color:rgba(255,255,255,.7);
  box-shadow:0 0 0 1px rgba(255,255,255,.75) inset, 0 0 10px rgba(255,255,255,.42), 0 0 20px rgba(255,255,255,.22);
}
.channel:active .ch-card{transform:scale(.985)}

.logo-wrap{display:grid; place-items:center; width:100%; height:100%}
.logo{max-height:var(--logo-max-h); max-width:var(--logo-max-w); object-fit:contain; filter:drop-shadow(0 1px 1px rgba(0,0,0,.35))}
.channel[data-wide="true"] .logo{max-height:var(--logo-wide-h)}
.name{
  width:100%; text-align:center; font-weight:700; font-size:12px; letter-spacing:.2px;
  color:#eaeef3; opacity:.95; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}

/* Ripple */
.ripple{
  position:absolute; border-radius:50%;
  background:radial-gradient(circle at center, rgba(255,255,255,.55), rgba(255,255,255,0));
  transform:scale(0); animation:ripple .5s ease-out; pointer-events:none;
}
@keyframes ripple{to{transform:scale(1);opacity:0}}

/* Misc */
#mini-toast{ user-select:none }

/* ---------- Responsive tweaks ---------- */
@media (max-width: 640px){
  :root{ --hud-size:30px }
  .refresh-btn{ padding:0 10px; font-size:11px }
  .h-wrap{
    padding-left:  calc(var(--hud-size) + 14px);
    padding-right: calc(var(--hud-size) + 14px);
  }
  #histats_counter{ transform:translateY(-50%) scale(0.82) }
}
@media (max-width: 420px){
  .refresh-btn .t{ display:none }
  .refresh-btn{ padding:0 8px }
}
@media (min-width: 1280px){
  #histats_counter{ transform:translateY(-50%) scale(1) }
}

/* ===== Selected tab: accent + underline + glow (PUT AT END) ===== */

/* สี accent รายหมวด (ตั้งที่ตัว .tab ด้วย data-filter) */
.tab[data-filter="IPTV"]   { --accent: #60a5fa; } /* ฟ้า */
.tab[data-filter="บันเทิง"] { --accent: #f59e0b; } /* เหลืองอำพัน */
.tab[data-filter="กีฬา"]    { --accent: #34d399; } /* เขียวมินต์ */
.tab[data-filter="สารคดี"]  { --accent: #a78bfa; } /* ม่วงพาสเทล */
.tab[data-filter="เด็ก"]    { --accent: #f472b6; } /* ชมพู */
.tab[data-filter="หนัง"]    { --accent: #fb7185; } /* ชมพูอมแดง */

/* Hover ใช้สี accent ให้ตอบสนอง */
@media (hover:hover){
  .tabs .tab:hover .tab-card{
    border-color: var(--accent, rgba(255,255,255,.28));
    box-shadow:
      0 0 0 1px color-mix(in oklab, var(--accent, #fff) 55%, transparent) inset,
      0 10px 18px rgba(0,0,0,.28),
      0 0 16px color-mix(in oklab, var(--accent, #fff) 30%, transparent);
  }
}

/* โฟกัสจากคีย์บอร์ด ใช้เส้นขอบสี accent */
.tabs .tab:focus-visible .tab-card{
  outline: 2px solid var(--accent, #8ab4ff);
  outline-offset: 3px;
}

/* === สถานะเลือก (selected) ให้เด่นชัด === */
.tabs .tab[aria-selected="true"] .tab-card{
  transform: translateZ(0) scale(1.08);
  border-color: var(--accent, rgba(255,255,255,.34));
  box-shadow:
    0 0 0 2px color-mix(in oklab, var(--accent, #fff) 48%, transparent) inset,
    0 12px 24px rgba(0,0,0,.34),
    0 0 18px color-mix(in oklab, var(--accent, #fff) 34%, transparent);
  z-index: 2;
  position: relative;
}

/* ขีดล่างบอกหมวดที่กำลังดู (ไม่กินพื้นที่การ์ด) */
.tabs .tab[aria-selected="true"] .tab-card::after{
  content:"";
  position:absolute; left:50%; bottom:-6px; transform:translateX(-50%);
  width:46%; height:4px; border-radius:4px;
  background: var(--accent, #86efac);
  filter: drop-shadow(0 0 6px color-mix(in oklab, var(--accent, #fff) 50%, transparent));
  pointer-events:none;
}

/* กันโดนสไตล์อื่นกลบเอฟเฟกต์ */
.tabs .tab[aria-selected="true"] .tab-card,
.tabs .tab:hover .tab-card,
.tabs .tab:focus-visible .tab-card{ z-index: 2; }
