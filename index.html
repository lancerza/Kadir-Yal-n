<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Online TV • Movies</title>
<link rel="icon" href="data:;base64,iVBORw0KGgo=">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/hls.js/1.5.8/hls.min.js"></script>

<style>
  :root{
    --bg:#0e0f13; --text:#eef2ff; --muted:#9aa4bd; --primary:#0d8eff;
    --panel:#121620; --border:#1f2431; --chip:#1b2130;
  }
  *{box-sizing:border-box}
  body{margin:0; font-family:'Sarabun',system-ui,-apple-system,Segoe UI,Roboto,sans-serif; background:var(--bg); color:var(--text)}
  .wrap{max-width:1100px; margin:20px auto 28px; padding:0 14px}

  /* Header */
  .head{display:flex; align-items:center; justify-content:space-between; margin-bottom:12px}
  .brand{display:flex; align-items:center; gap:10px; font-weight:700}
  .dot{width:10px; height:10px; border-radius:50%; background:var(--primary); box-shadow:0 0 10px rgba(13,142,255,.65)}
  .subtxt{color:var(--muted); font-size:.95rem}

  /* Player */
  .player{background:var(--panel); border:1px solid var(--border); border-radius:14px; overflow:hidden}
  .vbox{position:relative; background:#000}
  video{width:100%; display:block; aspect-ratio:16/9; background:#000}

  /* Controls (ultra clean) */
  .ctrl{position:absolute; left:0; right:0; bottom:0; display:flex; align-items:center; gap:10px; padding:8px 10px;
        background:linear-gradient(180deg, transparent, rgba(0,0,0,.55)); opacity:0; transform:translateY(8px); transition:.2s}
  .player:hover .ctrl, .ctrl.show{opacity:1; transform:translateY(0)}
  .cbtn{width:34px; height:34px; display:grid; place-items:center; border-radius:9px; background:rgba(255,255,255,.08);
        border:1px solid rgba(255,255,255,.18); color:#fff; cursor:pointer}
  .cbtn svg{width:18px; height:18px}
  #bar{flex:1; height:6px; accent-color:var(--primary)}
  #bar, #vol{appearance:none; -webkit-appearance:none; outline:none; background:transparent}
  #bar::-webkit-slider-runnable-track, #vol::-webkit-slider-runnable-track{height:6px; background:rgba(255,255,255,.18); border-radius:999px}
  #bar::-webkit-slider-thumb{ -webkit-appearance:none; width:12px; height:12px; border-radius:50%; background:var(--primary); margin-top:-3px }
  #vol{width:100px}
  #vol::-webkit-slider-thumb{ -webkit-appearance:none; width:10px; height:10px; border-radius:50%; background:var(--primary); margin-top:-2px }

  .live{background:#e53935; color:#fff; font-weight:800; padding:4px 10px; border-radius:8px; font-size:.85rem}
  .t{min-width:90px; text-align:center; color:#d9e2ff; font-size:.85rem}
  .hidden{display:none!important}

  /* Overlay */
  .overlay{position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:10px;
           background:rgba(5,10,20,.65); color:#fff; opacity:0; pointer-events:none; transition:.2s}
  .overlay.show{opacity:1; pointer-events:auto}
  .spin{border:4px solid rgba(255,255,255,.35); border-top:4px solid var(--primary); width:42px; height:42px; border-radius:50%; animation:spin 1s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}

  /* Only Movies grid */
  .title-row{display:flex; align-items:center; justify-content:space-between; margin:14px 2px 10px}
  .title-row h3{margin:0; font-size:1.1rem}
  .grid{display:grid; grid-template-columns:repeat(auto-fill, minmax(140px,1fr)); gap:10px}
  .card{border:1px solid var(--border); background:#0f131d; border-radius:12px; overflow:hidden; cursor:pointer; transition:transform .15s}
  .card:hover{transform:translateY(-2px)}
  .thumb{height:84px; display:flex; align-items:center; justify-content:center; background:#0b0f18}
  .thumb img{max-width:78%; max-height:68%; object-fit:contain; filter:drop-shadow(0 6px 16px rgba(0,0,0,.45))}
  .cbody{padding:8px 10px}
  .cname{font-weight:700; font-size:.95rem; line-height:1.25; color:#eaf0ff; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}

  @media (max-width:680px){
    .grid{grid-template-columns:repeat(auto-fill, minmax(128px,1fr))}
    .thumb{height:78px}
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="head">
    <div class="brand"><div class="dot"></div><div>Movies</div></div>
    <div class="subtxt" id="nowInfo">เลือกเรื่องเพื่อเริ่มรับชม</div>
  </div>

  <section class="player">
    <div class="vbox" id="vbox">
      <video id="video" playsinline></video>

      <div class="overlay" id="overlay">
        <div class="spin"></div>
        <div id="ovtxt">กำลังโหลด…</div>
      </div>

      <div class="ctrl" id="ctrl">
        <button id="play" class="cbtn" title="เล่น/หยุด (Space)">
          <svg class="i-play" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
          <svg class="i-pause hidden" viewBox="0 0 24 24" fill="currentColor"><path d="M6 19h4V5H6zm8-14v14h4V5z"/></svg>
        </button>
        <span id="time" class="t">--:-- / --:--</span>
        <span id="live" class="live hidden">LIVE</span>
        <input id="bar" type="range" value="0" step="1">
        <button id="mute" class="cbtn" title="เปิด/ปิดเสียง (M)">
          <svg class="i-vol" viewBox="0 0 24 24" fill="currentColor"><path d="M3 9v6h4l5 5V4L7 9H3zM16.5 12c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/></svg>
          <svg class="i-mute hidden" viewBox="0 0 24 24" fill="currentColor"><path d="M16.5 12c0-.22-.02-.43-.05-.63l-2.45-2.45V7.97A5.004 5.004 0 0121 12a7.9 7.9 0 01-.54 2.64l-1.51-1.51c.34-.82.54-1.7.54-2.64zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25 1.27-1.27L4.27 3z"/></svg>
        </button>
        <input id="vol" type="range" min="0" max="1" step="0.05" value="1" title="เสียง">
        <button id="fs" class="cbtn" title="เต็มจอ (F)">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M7 14H5v5h5v-2H7v-3zM5 10h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>
        </button>
      </div>
    </div>
  </section>

  <div class="title-row"><h3>รายการหนัง</h3></div>
  <section class="grid" id="grid"></section>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // ---------- Movies only ----------
  const movies = {
    "hls_doomovic1": { name:"Smurfs (2025) สเมิร์ฟ", url:"https://master.streamhls.com/hlsr2/344daafccf7c29fc7134386f145c785e/master.m3u8", logo:"https://www.037hdd-movie.com/wp-content/uploads/2025/07/Smurfs-2025.jpg" },
    "hls_doomovic2": { name:"An Honest Life (2025) ชีวิตซื่อ", url:"https://master.streamhls.com/hlsr2/46cabdb7b096b7bfc651293e8a682fbd/master.m3u8", logo:"https://www.037hdd-movie.com/wp-content/uploads/2025/08/An-Honest-Life-2025.jpg" },
    "hls_doomovic3": { name:"พระแท้ คนเก๊ (2025)", url:"https://master.streamhls.com/hlsr2/7341740f96136f2ea13b204d01dc203d/master.m3u8", logo:"https://www.037hdd-movie.com/wp-content/uploads/2025/08/The-Stone-2025.jpg" }
  };

  // ---------- State / DOM ----------
  let hls = null, currentId = null, loadingToken = 0;
  const MAX_REASONABLE_DUR = 8 * 3600; // 8 ชม. – เกินนี้ถือว่า duration เพี้ยน => แสดงแบบ LIVE/ซ่อนแถบเวลา

  const grid = document.getElementById('grid');
  const video = document.getElementById('video');
  const overlay = document.getElementById('overlay');
  const ovtxt = document.getElementById('ovtxt');
  const ctrl = document.getElementById('ctrl');
  const play = document.getElementById('play');
  const iPlay = play.querySelector('.i-play');
  const iPause = play.querySelector('.i-pause');
  const mute = document.getElementById('mute');
  const iVol = mute.querySelector('.i-vol');
  const iMute = mute.querySelector('.i-mute');
  const bar = document.getElementById('bar');
  const vol = document.getElementById('vol');
  const time = document.getElementById('time');
  const livePill = document.getElementById('live');
  const fs = document.getElementById('fs');
  const nowInfo = document.getElementById('nowInfo');

  // ---------- Helpers ----------
  const sleep = (ms) => new Promise(r => setTimeout(r, ms));
  const showOverlay = (t="กำลังโหลด…") => { ovtxt.textContent = t; overlay.classList.add('show'); };
  const hideOverlay = () => overlay.classList.remove('show');

  function formatTime(sec, forceHours=false){
    if(!isFinite(sec)) return '--:--';
    sec = Math.max(0, Math.floor(sec));
    const h = Math.floor(sec/3600), m = Math.floor((sec%3600)/60), s = sec%60;
    return (forceHours || h>0)
      ? `${String(h).padStart(1,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`
      : `${m}:${String(s).padStart(2,'0')}`;
  }

  function isLiveLike(){
    const d = video.duration;
    return !isFinite(d) || d <= 0 || d > MAX_REASONABLE_DUR;
  }

  function refreshTimeUI(){
    const liveLike = isLiveLike();
    livePill.classList.toggle('hidden', !liveLike);
    bar.classList.toggle('hidden', liveLike);

    if(liveLike){
      time.textContent = 'ถ่ายทอดสด';
    }else{
      const forceHours = video.duration >= 3600;
      time.textContent = `${formatTime(video.currentTime||0, forceHours)} / ${formatTime(video.duration||0, forceHours)}`;
      bar.max = isFinite(video.duration) ? video.duration : 0;
      bar.value = video.currentTime || 0;
    }
  }

  async function unload(){
    if(hls){ try{ hls.destroy(); }catch{} hls=null; }
    try{ video.pause(); }catch{}
    video.removeAttribute('src');
    try{ video.load(); }catch{}
    await sleep(80);
  }

  async function playHls(url){
    if (video.canPlayType('application/vnd.apple.mpegurl')) {
      video.src = url;
    } else if (window.Hls && Hls.isSupported()){
      hls = new Hls({lowLatencyMode:false, maxBufferLength:30, enableWorker:true});
      hls.attachMedia(video);
      hls.on(Hls.Events.MEDIA_ATTACHED, ()=> hls.loadSource(url));
      hls.on(Hls.Events.ERROR, (_, data)=>{
        if(data.fatal){
          if(data.type===Hls.ErrorTypes.NETWORK_ERROR) hls.startLoad();
          else if(data.type===Hls.ErrorTypes.MEDIA_ERROR) hls.recoverMediaError();
        }
      });
    } else {
      throw new Error('เบราว์เซอร์ไม่รองรับ HLS');
    }
  }

  async function switchMovie(id){
    if(currentId===id) return;
    const token = ++loadingToken;
    const mv = movies[id]; if(!mv) return;

    currentId = id;
    nowInfo.textContent = mv.name;
    showOverlay('กำลังโหลด…');

    try{
      await unload();
      if(token!==loadingToken) return;
      await playHls(mv.url);
      await sleep(120);
      hideOverlay();
      video.play().catch(()=>{});
    }catch(e){
      console.error(e);
      showOverlay('เล่นไม่ได้ ลองใหม่อีกครั้ง');
    }
  }

  // ---------- Build grid ----------
  function buildGrid(){
    grid.innerHTML='';
    Object.entries(movies).forEach(([id, mv])=>{
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <div class="thumb"><img loading="lazy" src="${mv.logo}" alt=""></div>
        <div class="cbody"><div class="cname">${mv.name}</div></div>
      `;
      card.onclick = ()=> switchMovie(id);
      card.onkeydown = (e)=>{ if(e.key==='Enter') switchMovie(id); };
      card.tabIndex = 0;
      grid.appendChild(card);
    });
  }

  // ---------- Controls ----------
  let ctrlTimer;
  const showCtrl = ()=>{ clearTimeout(ctrlTimer); ctrl.classList.add('show'); ctrlTimer=setTimeout(()=>ctrl.classList.remove('show'),2000); };
  document.getElementById('vbox').addEventListener('mousemove', showCtrl);
  document.getElementById('vbox').addEventListener('touchstart', showCtrl);

  play.addEventListener('click', ()=> video.paused?video.play():video.pause());
  mute.addEventListener('click', ()=> video.muted=!video.muted);
  vol.addEventListener('input', e=>{ video.volume = +e.target.value; if(video.volume>0 && video.muted) video.muted=false; });
  bar.addEventListener('input', e=> video.currentTime = +e.target.value);

  video.addEventListener('play', ()=>{ iPlay.classList.add('hidden'); iPause.classList.remove('hidden'); });
  video.addEventListener('pause', ()=>{ iPlay.classList.remove('hidden'); iPause.classList.add('hidden'); });
  video.addEventListener('timeupdate', refreshTimeUI);
  video.addEventListener('loadedmetadata', refreshTimeUI);
  video.addEventListener('durationchange', refreshTimeUI);

  fs.addEventListener('click', async ()=>{
    try{
      const box = document.getElementById('vbox');
      if(!document.fullscreenElement) await box.requestFullscreen();
      else await document.exitFullscreen();
    }catch{}
  });

  document.addEventListener('keydown', (e)=>{
    const tag = document.activeElement?.tagName;
    if(tag==='INPUT' || tag==='TEXTAREA') return;
    if(e.code==='Space'){ e.preventDefault(); video.paused?video.play():video.pause(); }
    else if(e.key.toLowerCase()==='m'){ video.muted=!video.muted; }
    else if(e.key.toLowerCase()==='f'){ fs.click(); }
    else if(e.key==='ArrowRight'){ video.currentTime=(video.currentTime||0)+5; }
    else if(e.key==='ArrowLeft'){ video.currentTime=Math.max(0,(video.currentTime||0)-5); }
  });

  // ---------- Init ----------
  buildGrid();
  // เล่นเรื่องแรกทันที
  const firstId = Object.keys(movies)[0];
  switchMovie(firstId);
});
</script>
</body>
</html>
