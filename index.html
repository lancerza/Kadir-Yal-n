<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Online TV</title>
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hls.js/1.5.8/hls.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.5/shaka-player.compiled.min.js"></script>
    
    <style>
        :root {
            --primary-color: #0d8eff;
            --background-color: #121212;
            --card-background: #1e1e1e;
            --text-color: #e0e0e0;
            --border-color: #333;
        }
        body { margin: 0; padding-bottom: 20px; background: var(--background-color); color: var(--text-color); font-family: 'Sarabun', sans-serif; display: flex; flex-direction: column; align-items: center; }
        .container { width: 95%; max-width: 1000px; }
        
        .header { text-align: center; padding: 15px 0; }
        #datetime-display { font-size: 1.1em; background: var(--card-background); padding: 8px 15px; border-radius: 20px; display: inline-block; border: 1px solid var(--border-color); }

        .video-container { 
            position: relative; 
            width: 100%; 
            border-radius: 12px; 
            overflow: hidden; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); 
            background-color: #000; 
        }
        video { width: 100%; display: block; aspect-ratio: 16 / 9; background-color: transparent; }
        
        .video-container:hover .custom-controls, .video-container .custom-controls.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .custom-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            opacity: 0;
            transform: translateY(100%);
            transition: opacity 0.3s, transform 0.3s;
            z-index: 2;
        }
        
        .control-btn { background: none; border: none; color: white; cursor: pointer; padding: 5px; opacity: 0.8; transition: opacity 0.2s, transform 0.2s; }
        .control-btn:hover { opacity: 1; transform: scale(1.1); }
        .control-btn svg { width: 24px; height: 24px; pointer-events: none; }
        .hidden { display: none; }

        #progress-bar { flex-grow: 1; accent-color: var(--primary-color); }
        #volume-slider { width: 100px; accent-color: var(--primary-color); }

        #live-indicator { background-color: red; padding: 4px 8px; border-radius: 5px; font-weight: bold; font-size: 0.8em; }

        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(0, 0, 0, 0.7); color: white; font-size: 1.2em; text-align: center; padding: 20px; box-sizing: border-box; pointer-events: none; opacity: 0; transition: opacity 0.3s ease; z-index: 3;}
        .overlay.visible { opacity: 1; pointer-events: auto; }
        .spinner { border: 4px solid rgba(255, 255, 255, 0.3); border-top: 4px solid var(--primary-color); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom: 10px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .category-header { width: 100%; margin: 25px 0 15px 0; padding-bottom: 5px; font-size: 1.5em; font-weight: 700; color: var(--primary-color); border-bottom: 2px solid var(--border-color); animation: fadeIn 0.5s ease forwards; }
        .channel-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 12px; }
        .channel-grid button { padding: 12px; font-size: 1em; border: 1px solid var(--border-color); border-radius: 8px; background: var(--card-background); color: var(--text-color); cursor: pointer; transition: all 0.2s ease-in-out; font-family: 'Sarabun', sans-serif; text-align: center; opacity: 0; animation: fadeIn 0.5s ease forwards; }
        .channel-grid button:hover { border-color: var(--primary-color); transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .channel-grid button.active { background: var(--primary-color); color: white; font-weight: 700; border-color: var(--primary-color); box-shadow: 0 0 15px rgba(0, 123, 255, 0.5); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <div id="datetime-display">Loading time...</div>
    </div>

    <div class="video-container" id="video-container">
        <video id="video"></video>
        <div id="video-overlay" class="overlay">
             <div id="overlay-content">
                <div id="spinner" class="spinner" style="display: none;"></div>
                <span id="overlay-text"></span>
            </div>
        </div>
        
        <div class="custom-controls" id="custom-controls">
            <button id="play-pause-btn" class="control-btn" title="เล่น/หยุด">
                 <svg viewBox="0 0 24 24" fill="currentColor" class="icon-play"><path d="M8 5v14l11-7z"></path></svg>
                 <svg viewBox="0 0 24 24" fill="currentColor" class="icon-pause hidden"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path></svg>
            </button>
            <input type="range" id="progress-bar" value="0" step="1" title="แถบเวลา">
            <div id="live-indicator" class="hidden">LIVE</div>
            <button id="mute-btn" class="control-btn" title="เปิด/ปิดเสียง">
                <svg viewBox="0 0 24 24" fill="currentColor" class="icon-volume-on"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg>
                <svg viewBox="0 0 24 24" fill="currentColor" class="icon-volume-off hidden"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"></path></svg>
            </button>
            <input type="range" id="volume-slider" min="0" max="1" step="0.05" value="1" title="ปรับเสียง">
            <button id="pip-btn" class="control-btn" title="Picture-in-Picture">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 7h-8v6h8V7zm2-4H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 14H3V5h18v12z"></path></svg>
            </button>
            <button id="fullscreen-btn" class="control-btn" title="เต็มจอ">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"></path></svg>
            </button>
        </div>
    </div>
    
    <div id="channels-container">
        </div>

</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const channels = {
            "กีฬา": {
                "aff_u23": { name: "Indo vs Thai U23", url: "https://tglmp04.akamaized.net/out/v1/400fc0702dee453bb33ebcc29466e58a/manifest.mpd", logo: "https://iili.io/FWccqEg.md.jpg", license_key: "91b9592c819246c68b3b08a1fe08ba22:fa0d80dfd865b34077bae44cd4a0c5e6" }
            },
            "ข่าว & ทั่วไป": {
                "thairath_dash": { name: "Thairath TV (DASH)", url: "https://tglmp02.akamaized.net/out/v1/cc0fc82e76cb4e0093e81695284af443/manifest.mpd", logo: "https://upload.wikimedia.org/wikipedia/th/b/b7/Thairath_TV_logo.png", license_key: "d418f733ed224f9bb9c2b1589db22a20:6ed6fe26daa4b926810869ff60254ebb" },
                "workpoint": { name: "Workpoint TV", url: "https://wp-live.cdn.3bb.co.th/wp/live/playlist.m3u8", logo: "https://upload.wikimedia.org/wikipedia/commons/4/49/Workpoint_TV_Logo.png", license_key: null },
                "thairathtv_hls": { name: "Thairath TV (HLS)", url: "https://d373k698imbfvs.cloudfront.net/out/v1/d08c879331984d948956b631988820c8/index.m3u8", logo: "https://upload.wikimedia.org/wikipedia/th/b/b7/Thairath_TV_logo.png", license_key: null }
            },
            "ช่อง 3BB": {
                "3bb1": { name: "3BB 1", url: "https://udn-streamer1.cdn.3bbtv.com:8443/3bb/live/2/2.mpd", logo: "https://seeklogo.com/images/3/3bb-internet-logo-373928F5D7-seeklogo.com.png", license_key: "ca20a93cf8e3421dafbd5bdb1990081b:86ae86a7391c481ea93eecdb740f0a14" },
                "3bb2": { name: "3BB 2", url: "https://udn-streamer1.cdn.3bbtv.com:8443/3bb/live/3/3.mpd", logo: "https://seeklogo.com/images/3/3bb-internet-logo-373928F5D7-seeklogo.com.png", license_key: "4d4426a505f64382a9841155d721cee6:0f4770219ccb4be5836a7517057e51c3" },
                "3bb3": { name: "3BB 3", url: "https://udn-streamer1.cdn.3bbtv.com:8443/3bb/live/4/4.mpd", logo: "https://seeklogo.com/images/3/3bb-internet-logo-373928F5D7-seeklogo.com.png", license_key: "1e98456bcbea44b7ad05831387e364ef:3d14fd4f9d3149a79b35a7124fccbd67" }
            }
        };

        let player;
        let currentChannelId = null;
        let controlsTimeout;

        const DOM = {
            video: document.getElementById('video'),
            videoContainer: document.getElementById('video-container'),
            channelLogo: document.getElementById('channel-logo'),
            channelsContainer: document.getElementById('channels-container'),
            overlay: document.getElementById('video-overlay'),
            overlayText: document.getElementById('overlay-text'),
            spinner: document.getElementById('spinner'),
            datetimeDisplay: document.getElementById('datetime-display'),
            // Custom Controls
            customControls: document.getElementById('custom-controls'),
            playPauseBtn: document.getElementById('play-pause-btn'),
            progressBar: document.getElementById('progress-bar'),
            liveIndicator: document.getElementById('live-indicator'),
            muteBtn: document.getElementById('mute-btn'),
            volumeSlider: document.getElementById('volume-slider'),
            pipBtn: document.getElementById('pip-btn'),
            fullscreenBtn: document.getElementById('fullscreen-btn')
        };

        function showOverlay(message, showSpinner = false) {
            DOM.overlayText.textContent = message;
            DOM.spinner.style.display = showSpinner ? 'block' : 'none';
            DOM.overlay.classList.add('visible');
        }

        function hideOverlay() { DOM.overlay.classList.remove('visible'); }

        async function init() {
            shaka.polyfill.installAll();
            if (!shaka.Player.isBrowserSupported()) {
                showOverlay("เบราว์เซอร์ของคุณไม่รองรับ ❌");
                return;
            }
            player = new shaka.Player(DOM.video);
            player.addEventListener('error', onPlayerError);
            
            setupEventListeners();
            generateChannelButtons();
            startClock();
            
            const lastChannel = localStorage.getItem('lastWatchedChannel') || 'aff_u23';
            await switchChannel(lastChannel);
        }

        async function switchChannel(channelId) {
            if (currentChannelId === channelId) return;
            currentChannelId = channelId;
            localStorage.setItem('lastWatchedChannel', channelId);
            updateActiveButton(channelId);
            showOverlay("กำลังโหลดช่อง...", true);
            
            let channel;
            for (const category in channels) {
                if (channels[category][channelId]) {
                    channel = channels[category][channelId];
                    break;
                }
            }

            if (!channel) {
                showOverlay(`ไม่พบช่อง ${channelId}`, false);
                return;
            }

            DOM.channelLogo.src = channel.logo;
            const drmConfig = { drm: { clearKeys: {} } };
            if (channel.license_key) {
                const [keyId, key] = channel.license_key.split(':');
                if (keyId && key) drmConfig.drm.clearKeys[keyId] = key;
            }
            player.configure(drmConfig);

            try {
                await player.unload();
                await player.load(channel.url);
                hideOverlay();
            } catch (err) { /* Error is handled by the onPlayerError event listener */ }
        }

        function onPlayerError(e) {
            console.error("Shaka error:", e.detail);
            showOverlay(`ไม่สามารถเล่นช่องได้\n(Error: ${e.detail.code})`, false);
        }

        function generateChannelButtons() {
            DOM.channelsContainer.innerHTML = '';
            for (const categoryName in channels) {
                const header = document.createElement('h2');
                header.className = 'category-header';
                header.textContent = categoryName;
                DOM.channelsContainer.appendChild(header);

                const grid = document.createElement('div');
                grid.className = 'channel-grid';
                let delay = 0;
                for (const id in channels[categoryName]) {
                    const channel = channels[categoryName][id];
                    const button = document.createElement('button');
                    button.innerText = channel.name;
                    button.dataset.channelId = id;
                    button.style.animationDelay = `${delay * 0.05}s`;
                    button.onclick = () => switchChannel(id);
                    grid.appendChild(button);
                    delay++;
                }
                DOM.channelsContainer.appendChild(grid);
            }
        }
        
        function updateActiveButton(channelId) {
            document.querySelectorAll('.channel-grid button').forEach(button => {
                button.classList.toggle('active', button.dataset.channelId === channelId);
            });
        }

        function startClock() {
            function updateTime() {
                const now = new Date();
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit' };
                DOM.datetimeDisplay.textContent = now.toLocaleDateString('th-TH', options);
            }
            updateTime();
            setInterval(updateTime, 1000);
        }

        // --- Setup for Custom Controls ---
        function setupEventListeners() {
            DOM.playPauseBtn.addEventListener('click', () => player.getMediaElement().paused ? player.getMediaElement().play() : player.getMediaElement().pause());
            DOM.muteBtn.addEventListener('click', () => player.getMediaElement().muted = !player.getMediaElement().muted);
            DOM.fullscreenBtn.addEventListener('click', () => DOM.videoContainer.requestFullscreen());
            DOM.pipBtn.addEventListener('click', () => player.getMediaElement().requestPictureInPicture());
            
            DOM.volumeSlider.addEventListener('input', e => player.getMediaElement().volume = e.target.value);
            DOM.progressBar.addEventListener('input', e => player.getMediaElement().currentTime = e.target.value);
            
            const video = player.getMediaElement();
            video.addEventListener('play', () => {
                DOM.playPauseBtn.querySelector('.icon-play').classList.add('hidden');
                DOM.playPauseBtn.querySelector('.icon-pause').classList.remove('hidden');
            });
            video.addEventListener('pause', () => {
                DOM.playPauseBtn.querySelector('.icon-play').classList.remove('hidden');
                DOM.playPauseBtn.querySelector('.icon-pause').classList.add('hidden');
            });
            video.addEventListener('volumechange', () => {
                DOM.volumeSlider.value = video.volume;
                const isMuted = video.muted || video.volume === 0;
                DOM.muteBtn.querySelector('.icon-volume-on').classList.toggle('hidden', isMuted);
                DOM.muteBtn.querySelector('.icon-volume-off').classList.toggle('hidden', !isMuted);
            });
            video.addEventListener('timeupdate', () => {
                if (player.isLive()) {
                    DOM.progressBar.style.display = 'none';
                    DOM.liveIndicator.classList.remove('hidden');
                } else {
                    DOM.progressBar.style.display = 'block';
                    DOM.liveIndicator.classList.add('hidden');
                    DOM.progressBar.max = video.duration;
                    DOM.progressBar.value = video.currentTime;
                }
            });
            
            DOM.videoContainer.addEventListener('mousemove', () => {
                clearTimeout(controlsTimeout);
                DOM.customControls.classList.add('visible');
                controlsTimeout = setTimeout(() => DOM.customControls.classList.remove('visible'), 3000);
            });
             DOM.videoContainer.addEventListener('mouseleave', () => {
                clearTimeout(controlsTimeout);
                DOM.customControls.classList.remove('visible');
            });
        }
        
        init();
    });
</script>
</body>
</html>
