<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ทีวีออนไลน์ ดูฟรีไม่เสียรายเดือน</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        /* ... CSS ทั้งหมดของคุณ ... */
        :root {
            --dark-bg: #1a1a1a;
            --light-text: #f0f0f0;
            --white: #FFFFFF;
            --red-accent: #ff4d4d;
            --line-blue: #2196F3;
            --line-green: #00B900;
            --border-radius: 8px;
            --component-bg: #333;
            --border-color: #555;
        }
        body.popup-open { overflow: hidden; }
        /* ... (CSS อื่นๆ ทั้งหมด) ... */
    </style>
</head>
<body>
    <div class="popup-overlay" id="disclaimer-popup" role="dialog" aria-modal="true" aria-labelledby="popup-title">
        <div class="popup-box">
            <h2 id="popup-title"></h2>
            <p id="popup-message"></p>
            <div class="popup-options">
                <input type="checkbox" id="dont-show-again">
                <label for="dont-show-again" id="popup-checkbox-label"></label>
            </div>
            <div class="popup-buttons">
                <button class="popup-btn btn-decline" id="decline-btn"></button>
                <button class="popup-btn btn-accept" id="accept-btn"></button>
            </div>
        </div>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- Element Variables & Global State ---
        let channelsData = [];
        let configData = {};

        // ... (โค้ดส่วนอื่น ๆ ที่ไม่เปลี่ยนแปลง) ...
        function applyTheme(theme) { /* ... */ }
        function getFavorites() { /* ... */ }
        // ... (ฯลฯ) ...

        // ✨ --- ฟังก์ชันที่อัปเดตใหม่ --- ✨
        async function loadAppData() {
            // !! สำคัญมาก: แก้ไข URL ทั้ง 2 บรรทัดนี้ให้เป็นลิงก์ RAW Gist ของคุณ
            const configUrl = 'https://raw.githubusercontent.com/ahmed9qn223/backend/refs/heads/main/config.json';
            const channelsUrl = 'https://raw.githubusercontent.com/ahmed9qn223/backend/refs/heads/main/channels.json';

            try {
                const [configResponse, channelsResponse] = await Promise.all([
                    fetch(configUrl),
                    fetch(channelsUrl)
                ]);

                if (!configResponse.ok || !channelsResponse.ok) {
                    throw new Error(`Network response was not ok. Statuses: ${configResponse.status}, ${channelsResponse.status}`);
                }

                const [configJson, channelsJson] = await Promise.all([
                    configResponse.json(),
                    channelsResponse.json()
                ]);
                
                console.log("Data fetched successfully:", { config: configJson, channels: channelsJson });

                configData = configJson || {};
                channelsData = channelsJson.channels || [];

            } catch (error) {
                console.error('Error loading application data:', error);
                configData = {}; 
                channelsData = [];
                showNotification('เกิดข้อผิดพลาดในการโหลดข้อมูลหลัก');
            }
        }

        function populatePopupContent(disclaimerConfig) {
            const config = disclaimerConfig || {};
            document.getElementById('popup-title').textContent = config.title || 'ข้อจำกัดความรับผิดชอบ';
            document.getElementById('popup-message').textContent = config.message || 'ไม่สามารถโหลดเนื้อหาได้ โปรดตรวจสอบไฟล์ JSON';
            document.getElementById('popup-checkbox-label').textContent = config.checkboxLabel || 'ไม่ต้องแสดงอีก';
            document.getElementById('accept-btn').textContent = config.acceptText || '✅ ยอมรับ';
            document.getElementById('decline-btn').textContent = config.declineText || '❌ ปิด';
        }

        function setupPopup() {
            const hasAcceptedPermanently = localStorage.getItem('disclaimerAccepted');
            if (hasAcceptedPermanently) return;

            // ตอนนี้ configData มาจากไฟล์แยก
            populatePopupContent(configData.disclaimer);

            // ... (โค้ด Popup ที่เหลือเหมือนเดิม) ...
            function showPopup() { /* ... */ }
            function hidePopup() { /* ... */ }
            showPopup();
            // ... (Event Listeners ของ Popup) ...
        }

        function initializeApp() {
            // ... (โค้ดส่วนต้นของ initializeApp เหมือนเดิม) ...
            
            loadAppData().then(() => {
                // ... (โค้ดส่วนท้ายของ initializeApp ที่ต้องใช้ข้อมูลที่โหลดมาแล้ว) ...
                setupPopup();
                // ... (โค้ดสร้าง accordion, favorites ฯลฯ) ...
            });
        }
        
        // (ส่วนที่เหลือของโค้ด JS ทั้งหมดของคุณ)
        // ...
        
        initializeApp();
    });
    </script>
</body>
</html>
