<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ทีวีออนไลน์ รวมลิงก์ดูทีวี กีฬา และหนังออนไลน์ในที่เดียว">
    <meta name="keywords" content="ทีวีออนไลน์, ดูหนัง, กีฬา, YouTube">
    <title>ทีวีออนไลน์ ดูฟรีไม่เสียรายเดือน</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-KBRV24KW7F"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-KBRV24KW7F');
    </script>

    <style>
        :root {
            --dark-bg: #1a1a1a;
            --light-text: #f0f0f0;
            --white: #FFFFFF;
            --red-accent: #ff4d4d;
            --line-blue: #2196F3;
            --line-green: #00B900;
            --border-radius: 8px;
            --spacing-xs: 5px;
            --spacing-sm: 8px;
            --spacing-md: 10px;
            --spacing-lg: 15px;
            --spacing-xl: 20px;
        }

        /* Animation for header (Fade in) */
        @keyframes fadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }

        /* Animation for running text */
        @keyframes marquee {
            0% { transform: translateX(100%); } /* Start from right */
            100% { transform: translateX(-100%); } /* Go to far left */
        }

        html, body {
            margin: 0;
            padding: 0 var(--spacing-md);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            overflow-x: hidden;
            background-color: var(--dark-bg);
            color: var(--light-text);
            font-family: 'Arial', sans-serif;
            text-align: center;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        header {
            background-color: var(--dark-bg);
            color: var(--white);
            padding: 2vw 4vw;
            border-radius: var(--border-radius);
            margin: 5vh 0 2vh 0;
            animation: fadeIn 3s ease-out;
            width: 100%;
            box-sizing: border-box;
        }

        #running-text-container {
            width: 100%;
            margin-bottom: var(--spacing-xs);
            position: relative;
            height: 20px;
            overflow: hidden;
        }

        #running-text {
            display: inline-block;
            white-space: nowrap;
            color: var(--red-accent);
            font-family: 'Kanit', sans-serif;
            font-size: clamp(12px, 2vw, 16px);
            font-weight: 700;
            animation: marquee 15s linear infinite;
            position: absolute;
            top: 0;
            left: 0;
            min-width: 100%;
            cursor: default;
        }

        h1 {
            color: var(--white);
            text-align: center;
            font-family: 'Kanit', sans-serif;
            font-size: clamp(24px, 5vw, 40px);
            font-weight: 900;
            letter-spacing: 2px;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.4), 0 0 12px rgba(255, 255, 255, 0.2);
            margin-top: 1px;
            margin-bottom: var(--spacing-md);
        }

        #current-datetime {
            font-family: 'Kanit', sans-serif;
            font-size: clamp(14px, 2.5vw, 20px);
            color: rgba(255, 255, 255, 0.8);
            margin-top: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
            font-weight: 400;
        }

        #line-group-info {
            font-family: 'Kanit', sans-serif;
            font-size: clamp(14px, 2.5vw, 20px);
            color: var(--line-blue);
            margin-top: var(--spacing-md);
            margin-bottom: var(--spacing-xl);
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            text-decoration: none;
        }

        #line-group-info:hover {
            color: #1976D2;
        }

        #line-group-info i {
            font-size: 25px;
            vertical-align: middle;
            color: var(--line-green);
        }

        #line-group-info i.fa-brands.fa-line.left-icon {
            margin-right: var(--spacing-sm);
        }

        #line-group-info i.fa-brands.fa-line.right-icon {
            margin-left: var(--spacing-sm);
        }

        main.categories-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: var(--spacing-lg);
            width: 100%;
            max-width: 1200px;
            margin-top: clamp(30px, 6vw, 50px);
            padding-bottom: var(--spacing-md);
            flex-grow: 1;
            align-items: flex-start;
        }

        .category {
            background-color: var(--dark-bg);
            border-radius: var(--border-radius);
            padding: var(--spacing-xs);
            flex: 0 0 auto;
            width: 220px;
            box-sizing: border-box;
            transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 1px solid var(--dark-bg);
            height: auto;
            box-shadow: none;
        }

        .category:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        @media (max-width: 768px) {
            .categories-container {
                gap: var(--spacing-md);
            }
            .category {
                width: calc(50% - 15px);
                max-width: unset;
            }
        }

        @media (max-width: 480px) {
            .categories-container {
                gap: var(--spacing-md);
                padding: 0 var(--spacing-xs) var(--spacing-md) var(--spacing-xs);
            }
            .category {
                width: calc(100% - 10px);
                margin-left: auto;
                margin-right: auto;
            }
        }

        .accordion-button {
            background: linear-gradient(145deg, #424242, #333333);
            color: var(--white);
            font-family: 'Kanit', sans-serif;
            font-size: 1.3em;
            font-weight: bold;
            padding: 7px 14px;
            border-radius: var(--border-radius);
            cursor: pointer;
            width: 100%;
            text-align: center;
            margin-bottom: 0;
            transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease, border-color 0.3s ease;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
            box-sizing: border-box;
            border: 1px solid var(--white);
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .accordion-button:hover {
            background: linear-gradient(145deg, #616161, #505050);
            transform: translateY(-3px);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.6);
            border-color: var(--white);
        }

        .accordion-button:active {
            transform: translateY(0);
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.5);
            background: #333333;
            border-color: #AAAAAA;
        }

        .accordion-button i {
            margin-right: var(--spacing-sm);
            color: rgba(255, 255, 255, 0.8);
        }

        .accordion-content {
            max-height: 0;
            padding: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, padding 0.3s ease-out, opacity 0.3s ease-out;
            display: none;
            opacity: 0;
            width: 100%;
            flex-wrap: wrap;
            justify-content: center;
            gap: var(--spacing-sm);
            position: relative;
        }

        .accordion-content.show {
            display: flex;
            opacity: 1;
            padding-top: var(--spacing-sm);
            padding-bottom: var(--spacing-sm);
        }

        main img {
            border-radius: var(--border-radius);
            border: 1px solid var(--white);
            padding: 3px;
            margin: 0;
            height: 50px;
            width: 50px;
            object-fit: cover;
            vertical-align: middle;
            transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
            cursor: pointer;
        }

        main img:hover {
            transform: scale(1.05);
            border-color: var(--white);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.7), 0 0 20px rgba(255, 255, 255, 0.5);
        }

        footer {
            margin-top: auto;
            padding: var(--spacing-xl);
            color: var(--light-text);
            background-color: var(--dark-bg);
            width: 100%;
            text-align: center;
            border-top: none;
        }

        /* --- CSS สำหรับ Loading Indicator และ No Channels Message --- */
        .loading-indicator, .no-channels-message {
            width: 100%;
            text-align: center;
            padding: var(--spacing-md);
            color: rgba(255, 255, 255, 0.7);
            font-family: 'Kanit', sans-serif;
            font-size: clamp(14px, 2.5vw, 18px);
            display: none;
        }

        .loading-indicator.active, .no-channels-message.active {
            display: block;
        }

        .loading-indicator i.fa-spinner {
            animation: spin 1s linear infinite;
            margin-right: var(--spacing-xs);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* --- สิ้นสุด CSS สำหรับ Loading Indicator และ No Channels Message --- */

    </style>
</head>
<body>
    <header>
        <div id="running-text-container">
            <div id="running-text">
                </div>
        </div>
        <h1>เชิญดูฟรีไม่เสียรายเดือน</h1>
        <time id="current-datetime" aria-live="polite"></time>
        <a href="https://line.me/ti/g2/7xI-GwYG_G9qyuLqXhj79IwFj4Gv1-6boc5DuA?utm_source=invitation&utm_medium=link_copy&utm_campaign=default" id="line-group-info" target="_blank" rel="noopener noreferrer">
            <i class="fa-brands fa-line left-icon"></i> เข้ากลุ่มไลน์อัพเดทต่างๆ
            <i class="fa-brands fa-line right-icon"></i>
        </a>
    </header>

    <main class="categories-container">
        <div class="category">
            <button class="accordion-button" aria-expanded="false" aria-controls="content-thai-tv">
                <i class="fas fa-tv"></i> ทีวีดิจิตอล
            </button>
            <div id="content-thai-tv" class="accordion-content">
                <div class="loading-indicator"><i class="fas fa-spinner"></i> กำลังโหลดช่อง...</div>
                <div class="no-channels-message">ไม่พบช่องในหมวดหมู่นี้</div>
            </div>
        </div>

        <div class="category">
            <button class="accordion-button" aria-expanded="false" aria-controls="content-sport">
                <i class="fas fa-running"></i> กีฬา
            </button>
            <div id="content-sport" class="accordion-content">
                <div class="loading-indicator"><i class="fas fa-spinner"></i> กำลังโหลดช่อง...</div>
                <div class="no-channels-message">ไม่พบช่องในหมวดหมู่นี้</div>
            </div>
        </div>

        <div class="category">
            <button class="accordion-button" aria-expanded="false" aria-controls="content-movies">
                <i class="fas fa-film"></i> หนังทีวี
            </button>
            <div id="content-movies" class="accordion-content">
                <div class="loading-indicator"><i class="fas fa-spinner"></i> กำลังโหลดช่อง...</div>
                <div class="no-channels-message">ไม่พบช่องในหมวดหมู่นี้</div>
            </div>
        </div>

        <div class="category">
            <button class="accordion-button" aria-expanded="false" aria-controls="content-iptv">
                <i class="fas fa-network-wired"></i> IPTV
            </button>
            <div id="content-iptv" class="accordion-content">
                <div class="loading-indicator"><i class="fas fa-spinner"></i> กำลังโหลดช่อง...</div>
                <div class="no-channels-message">ไม่พบช่องในหมวดหมู่นี้</div>
            </div>
        </div>
    </main>

    <footer>
        <p id="footer-text">
            </p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const datetimeDisplay = document.getElementById('current-datetime');
            const runningTextElement = document.getElementById('running-text'); // เข้าถึง element ข้อความวิ่ง
            const footerTextElement = document.getElementById('footer-text'); // เข้าถึง element ข้อความท้าย
            const categoryContentMap = {
                "ทีวีดิจิตอล": document.getElementById('content-thai-tv'),
                "กีฬา": document.getElementById('content-sport'),
                "หนังทีวี": document.getElementById('content-movies'),
                "IPTV": document.getElementById('content-iptv')
            };
            let channelsData = null; // เก็บข้อมูลช่องที่โหลดมาแล้ว
            let textsData = null; // เก็บข้อมูลข้อความที่โหลดมาแล้ว

            const redAccentColor = getComputedStyle(document.documentElement).getPropertyValue('--red-accent').trim();

            // ฟังก์ชันแสดง/ซ่อน loading indicator และ no channels message
            function showLoading(container) {
                container.querySelector('.loading-indicator').classList.add('active');
                container.querySelector('.no-channels-message').classList.remove('active');
                Array.from(container.children).forEach(child => {
                    if (!child.classList.contains('loading-indicator') && !child.classList.contains('no-channels-message')) {
                        child.remove();
                    }
                });
            }

            function hideLoading(container) {
                container.querySelector('.loading-indicator').classList.remove('active');
            }

            function showNoChannelsMessage(container) {
                hideLoading(container);
                container.querySelector('.no-channels-message').classList.add('active');
            }

            function clearMessages(container) {
                container.querySelector('.loading-indicator').classList.remove('active');
                container.querySelector('.no-channels-message').classList.remove('active');
            }

            // ฟังก์ชันโหลด channels.json
            async function loadChannelsData() {
                if (channelsData) return;
                try {
                    const response = await fetch('channels.json');
                    if (!response.ok) {
                        const errorText = response.status === 404
                            ? `channels.json not found (HTTP 404). Please ensure the file exists at the root of your server.)`
                            : `Failed to load channels.json: HTTP error! status: ${response.status}`;
                        throw new Error(errorText);
                    }
                    const data = await response.json();
                    if (!Array.isArray(data)) {
                        throw new Error('Fetched data from channels.json is not an array. Please ensure the JSON is an array of channel objects.');
                    }
                    channelsData = data;
                } catch (error) {
                    console.error('Error loading or parsing channels.json:', error);
                    // แสดงข้อความผิดพลาดในทุก accordion content
                    Object.values(categoryContentMap).forEach(container => {
                        container.innerHTML = `<div class="no-channels-message active" style="color: ${redAccentColor};">
                                                    เกิดข้อผิดพลาดในการโหลดช่อง: ${error.message}<br>โปรดลองใหม่อีกครั้งในภายหลัง
                                                </div>`;
                    });
                    channelsData = [];
                }
            }

            // ฟังก์ชันโหลด texts.json
            async function loadTextsData() {
                if (textsData) return;
                try {
                    const response = await fetch('texts.json');
                    if (!response.ok) {
                        const errorText = response.status === 404
                            ? `texts.json not found (HTTP 404). Please ensure the file exists at the root of your server.)`
                            : `Failed to load texts.json: HTTP error! status: ${response.status}`;
                        throw new Error(errorText);
                    }
                    const data = await response.json();
                    if (typeof data !== 'object' || data === null) {
                        throw new Error('Fetched data from texts.json is not a valid object.');
                    }
                    textsData = data;
                    // นำข้อความไปใส่ใน element ที่เกี่ยวข้อง
                    if (runningTextElement && textsData.runningText) {
                        runningTextElement.textContent = textsData.runningText;
                    }
                    if (footerTextElement && textsData.footerText) {
                        footerTextElement.textContent = textsData.footerText;
                    }
                } catch (error) {
                    console.error('Error loading or parsing texts.json:', error);
                    // Fallback to default text if loading fails
                    if (runningTextElement) runningTextElement.textContent = "Error loading running text!";
                    if (footerTextElement) footerTextElement.textContent = "Error loading footer text!";
                }
            }

            // โหลดข้อมูลทั้งหมดเมื่อ DOM พร้อม
            loadChannelsData();
            loadTextsData(); // โหลดข้อความด้วย

            document.querySelector('main.categories-container').addEventListener('click', function(event) {
                const link = event.target.closest('.channel-link');
                if (link) {
                    event.preventDefault();
                    const url = link.dataset.url;
                    const imgElement = link.querySelector('img');
                    const channelName = imgElement ? imgElement.alt : 'Unknown Channel';
                    const categoryElement = link.closest('.category');
                    const categoryButton = categoryElement ? categoryElement.querySelector('.accordion-button') : null;
                    const categoryName = categoryButton ? categoryButton.innerText.replace(/[\u{1F000}-\u{1FFFF}\u{2000}-\u{2BFF}]/gu, '').trim() : 'Unknown Category';
                    if (typeof gtag === 'function') {
                        gtag('event', 'channel_click', { 'channel_name': channelName, 'category': categoryName, 'link_url': url });
                    }
                    setTimeout(() => { if (url) window.location.href = url; }, 200);
                }
            });

            function formatDateTime(date) {
                const optionsDate = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                const optionsTime = { hour: '2-digit', minute: '2-digit', hour12: false };
                const datePart = date.toLocaleDateString('th-TH', optionsDate);
                const timePart = date.toLocaleTimeString('th-TH', optionsTime);
                return { display: `${datePart} ${timePart}`, iso: date.toISOString() };
            }

            function updateDateTime() {
                const now = new Date();
                const formatted = formatDateTime(now);
                datetimeDisplay.textContent = formatted.display;
                datetimeDisplay.setAttribute('datetime', formatted.iso);
            }
            updateDateTime();
            setInterval(updateDateTime, 1000);

            document.querySelectorAll('.accordion-content').forEach(contentElement => {
                contentElement.addEventListener('transitionend', function() {
                    if (!this.classList.contains('show')) {
                        const computedMaxHeight = window.getComputedStyle(this).maxHeight;
                        if (computedMaxHeight === '0px') {
                            this.style.display = 'none';
                        }
                    }
                });
            });

            function closeAccordion(contentElement, buttonElement) {
                contentElement.classList.remove('show');
                contentElement.style.maxHeight = '0px';
                buttonElement.setAttribute('aria-expanded', 'false');
            }

            async function openAccordion(contentElement, buttonElement) {
                contentElement.style.display = 'flex';
                buttonElement.setAttribute('aria-expanded', 'true');

                showLoading(contentElement);

                if (!channelsData) {
                    await loadChannelsData(); // ใช้ loadChannelsData() แทน
                }

                clearMessages(contentElement);

                const categoryText = buttonElement.innerText.replace(/[\u{1F000}-\u{1FFFF}\u{2000}-\u{2BFF}]/gu, '').trim();
                const filteredChannels = channelsData.filter(channel => channel.category === categoryText);

                if (filteredChannels.length === 0) {
                    showNoChannelsMessage(contentElement);
                } else {
                    filteredChannels.forEach(channel => {
                        const link = document.createElement('a');
                        link.href = "#";
                        link.classList.add('channel-link');
                        link.dataset.url = channel.data_url;
                        link.setAttribute('aria-label', channel.aria_label);
                        const img = document.createElement('img');
                        img.src = channel.img_src;
                        img.alt = channel.name;
                        img.loading = "lazy";
                        link.appendChild(img);
                        contentElement.appendChild(link);
                    });
                }

                requestAnimationFrame(() => {
                    const actualContentHeight = contentElement.scrollHeight;
                    contentElement.style.maxHeight = (actualContentHeight + 16) + 'px';
                    contentElement.classList.add('show');
                });
            }

            const allAccordionButtons = document.querySelectorAll('.accordion-button');
            allAccordionButtons.forEach(button => {
                const content = button.nextElementSibling;
                button.addEventListener('click', function() {
                    allAccordionButtons.forEach(otherButton => {
                        const otherContent = otherButton.nextElementSibling;
                        if (otherButton !== this && otherContent && otherContent.classList.contains('show')) {
                            closeAccordion(otherContent, otherButton);
                        }
                    });
                    if (content && content.classList.contains('show')) {
                        closeAccordion(content, this);
                    } else if (content) {
                        openAccordion(content, this);
                    }
                });
            });

            // --- ส่วนป้องกันการดูโค้ด ---
            document.addEventListener('contextmenu', e => e.preventDefault());
            document.addEventListener('selectstart', e => e.preventDefault());
            document.addEventListener('dragstart', e => e.preventDefault());
            document.addEventListener('drop', e => e.preventDefault());
            document.addEventListener('keydown', e => {
                if (e.key === ' ' || e.key === 'Enter') return;
                if (e.ctrlKey || e.metaKey) {
                    if (e.shiftKey && (e.key === 'I' || e.key === 'J' || e.key === 'C')) e.preventDefault();
                    else {
                        const lowerKey = e.key.toLowerCase();
                        if (['s', 'p', 'u', 'a', 'c', 'x', 'v'].includes(lowerKey)) e.preventDefault();
                    }
                }
                if (e.key === 'F12') e.preventDefault();
            });
            // --- สิ้นสุดส่วนป้องกันการดูโค้ด ---
        });
    </script>
</body>
</html>
